!function(e){var t={},i={onReady:function(){this.setupDOM(),this.eventListeners(),this.initializeDependencies()},setupDOM:function(){t.select2=e(".rzwm-hacking-select"),t.dateTimePicker=e("#datetimepicker"),t.reportsDatePicker=e("#reports_date"),t.zoomAccountDatepicker=e(".zoom_account_datepicker"),t.dataTable=e("#rzwm_users_list_table, #rzwm_meetings_list_table"),t.meetingListTableCheck=e("#rzwm_meetings_list_table"),t.meetingListTbl=t.meetingListTableCheck.find("input[type=checkbox]"),t.cover=e("#rzwm-cover"),t.togglePwd=e(".toggle-api"),t.toggleSecret=e(".toggle-secret"),this.meetingType=e(".meeting-type-selection"),t.changeMeetingState=e(".rzwm-meeting-state-change"),t.show_on_meeting_delete_error=e(".show_on_meeting_delete_error")},eventListeners:function(){t.meetingListTableCheck.find("#checkall").on("click",this.meetingListTableCheck),e("#bulk_delete_meeting_listings").on("click",this.bulkDeleteMeetings),e(".rzwm-meetings-form").find('input[name="password"]').on("keypress",this.meetingPassword),e(".delete-meeting").on("click",this.deleteMetting),t.togglePwd.on("click",this.toggleAPISettings.bind(this)),t.toggleSecret.on("click",this.toggleSecretSettings.bind(this)),e(".rzwm-dismiss-message").on("click",this.dismissNotice.bind(this)),e(".check-api-connection").on("click",this.checkConnection.bind(this)),e(t.changeMeetingState).on("click",this.meetingStateChange.bind(this)),e(this.meetingType).on("change",this.meetingTypeCB.bind(this))},initializeDependencies:function(){t.select2.length>0&&t.select2.select2(),this.datePickers(),t.dataTable.length>0&&t.dataTable.dataTable({pageLength:25,columnDefs:[{targets:0,orderable:!1}]})},datePickers:function(){if(t.dateTimePicker.length>0){var i=new Date,n=i.getMonth()+1,s=i.getDate(),a=i.getHours()+":"+i.getMinutes()+":"+i.getSeconds(),r=i.getFullYear()+"-"+(n<10?"0":"")+n+"-"+(s<10?"0":"")+s+" "+a,c=t.dateTimePicker.data("existingdate");c&&(r=c),t.dateTimePicker.datetimepicker({value:r,step:15,minDate:0,format:"Y-m-d H:i"})}t.reportsDatePicker.length>0&&t.reportsDatePicker.datepicker({changeMonth:!0,changeYear:!1,showButtonPanel:!0,dateFormat:"MM yy"}).focus(function(){var t=e(this);e(".ui-datepicker-calendar").detach(),e(".ui-datepicker-close").click(function(){var i=e("#ui-datepicker-div .ui-datepicker-month :selected").val(),n=e("#ui-datepicker-div .ui-datepicker-year").html();t.datepicker("setDate",new Date(n,i,1))})}),t.zoomAccountDatepicker.length>0&&t.zoomAccountDatepicker.datepicker({dateFormat:"yy-mm-dd"})},meetingListTableCheck:function(){e(this).is(":checked")?t.meetingListTbl.each(function(){e(this).prop("checked",!0)}):t.meetingListTbl.each(function(){e(this).prop("checked",!1)})},bulkDeleteMeetings:function(){if(1!=confirm("Confirm bulk delete these Meeting?"))return!1;var i=[];t.meetingListTableCheck.find("input.checkthis").each(function(){e(this).is(":checked")&&i.push(e(this).val())});var n=e(this).data("hostid");if(i){var s={meetings_id:i,host_id:n,action:"rzwm_bulk_meetings_delete",security:rzwm_ajax.rzwm_security};t.cover.show(),e.post(rzwm_ajax.ajaxurl,s).done(function(e){t.cover.fadeOut("slow"),1==e.error?t.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"):(t.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"),location.reload())})}},meetingPassword:function(t){if(!/([a-zA-Z0-9])+/.test(String.fromCharCode(t.which)))return!1;var i=e(this).val(),n=e(this).data("maxlength");n>0&&e(this).val(i.substr(0,n))},deleteMetting:function(){var i=e(this).data("meetingid"),n=e(this).data("hostid");if(1!=confirm("Confirm Delete this Meeting?"))return!1;var s={meeting_id:i,host_id:n,action:"rzwm_delete_meeting",security:rzwm_ajax.rzwm_security};t.cover.show(),e.post(rzwm_ajax.ajaxurl,s).done(function(e){t.cover.fadeOut("slow"),1==e.error?t.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"):(t.show_on_meeting_delete_error.show().html("<p>"+e.msg+"</p>"),location.reload())})},toggleAPISettings:function(){var i=e("#zoom_api_key");"Show"===t.togglePwd.html()?(t.togglePwd.html("Hide"),i.attr("type","text")):(t.togglePwd.html("Show"),i.attr("type","password"))},toggleSecretSettings:function(){var i=e("#zoom_api_secret");"Show"===t.toggleSecret.html()?(t.toggleSecret.html("Hide"),i.attr("type","text")):(t.toggleSecret.html("Show"),i.attr("type","password"))},dismissNotice:function(t){t.preventDefault(),e(t.currentTarget).closest(".notice-success").hide(),e.post(rzwm_ajax.ajaxurl,{action:"zoom_dimiss_notice"}).done(function(e){console.log(e)})},checkConnection:function(i){i.preventDefault(),t.cover.show(),e.post(rzwm_ajax.ajaxurl,{action:"check_connection",security:rzwm_ajax.rzwm_security}).done(function(e){t.cover.hide(),alert(e)})},meetingStateChange:function(t){t.preventDefault();var i=e(t.currentTarget).data("state"),n=e(t.currentTarget).data("postid"),s={id:e(t.currentTarget).data("id"),state:i,type:e(t.currentTarget).data("type"),post_id:n||!1,action:"state_change",accss:rzwm_ajax.rzwm_security};if("resume"===i)this.changeState(s);else if("end"===i){if(!confirm(rzwm_ajax.lang.confirm_end))return;this.changeState(s)}},changeState:function(t){e.post(rzwm_ajax.ajaxurl,t).done(function(e){location.reload()})},meetingTypeCB:function(t){t.preventDefault(),console.log(e(t.currentTarget).val())}},n={init:function(){this.cacheDOM(),this.evntHandlers()},cacheDOM:function(){this.notificationWrapper=e(".rzwm-status-notification"),this.syncUserId=e(".rzwm-sync-user-id")},evntHandlers:function(){this.syncUserId.on("change",this.fetchMeetingsByUser.bind(this))},fetchMeetingsByUser:function(t){t.preventDefault();var i=this,n=e(this.syncUserId).val(),s={user_id:n,action:"rzwm_sync_user",type:"check"},a=e(".results");a.html("<p>"+rzwm_sync_i10n.before_sync+"</p>"),e.post(ajaxurl,s).done(function(t){if(t.success){var s='<div class="rzwm-sync-details">';s+="<p><strong>"+rzwm_sync_i10n.total_records_found+":</strong> "+t.data.total_records+"</p>",s+="<p><strong>"+rzwm_sync_i10n.total_not_synced_records+":</strong> "+_.size(t.data.meetings)+" (Only listing Scheduled Meetings)</p>",s+='<select class="rzwm-choose-meetings-to-sync-select2" name="sync-meeting-ids[]" multiple="multiple">',e(t.data.meetings).each(function(e,t){s+='<option value="'+t.id+'">'+t.topic+"</option>"}),s+="</select>",setTimeout(function(){e(".rzwm-choose-meetings-to-sync-select2").select2({maximumSelectionLength:10,placeholder:rzwm_sync_i10n.select2_placeholder})},100),s+='<p><a href="javascript:void(0);" class="rzwm-sync-meeting button button-primary" data-userid="'+n+'">'+rzwm_sync_i10n.sync_btn+"</a></p>",s+="</div>",a.html(s),e(".rzwm-sync-meeting").on("click",i.syncMeeting.bind(i))}else a.html("<p>"+t.data+"</p>")})},syncMeeting:function(t){t.preventDefault(),e(t.currentTarget).attr("disabled","disabled");var i=e(".rzwm-choose-meetings-to-sync-select2").val();_.size(i)>0?(this.notificationWrapper.show().html("<p>"+rzwm_sync_i10n.sync_start+"</p>").removeClass("rzwm-error"),this.doSync(0,i)):(this.notificationWrapper.show().html("<p>"+rzwm_sync_i10n.sync_error+"</p>").addClass("rzwm-error"),e(t.currentTarget).removeAttr("disabled"))},doSync:function(t,i){var s=this,a={action:"rzwm_sync_user",type:"sync",meeting_id:i[t]};e.post(ajaxurl,a).done(function(a){t++,s.notificationWrapper.show().append("<p> "+a.data.msg+"</p>"),t<_.size(i)?n.doSync(t,i):a.success?(s.notificationWrapper.show().append("<p>"+rzwm_sync_i10n.sync_completed+"</p>"),e(".rzwm-sync-meeting").removeAttr("disabled")):(s.notificationWrapper.show().append("<p>"+a.data.msg+"</p>"),e(".rzwm-sync-meeting").removeAttr("disabled"))})}};e(function(){i.onReady(),n.init()})}(jQuery);